import{r as M,R as g}from"./app-1abff991.js";const H={x:0,y:0,width:0,height:0,unit:"px"},b=(a,e,t)=>Math.min(Math.max(a,e),t),E=(...a)=>a.filter(e=>e&&typeof e=="string").join(" "),Y=(a,e)=>a===e||a.width===e.width&&a.height===e.height&&a.x===e.x&&a.y===e.y&&a.unit===e.unit;function _(a,e,t,r){const n=y(a,t,r);return a.width&&(n.height=n.width/e),a.height&&(n.width=n.height*e),n.y+n.height>r&&(n.height=r-n.y,n.width=n.height*e),n.x+n.width>t&&(n.width=t-n.x,n.height=n.width/e),a.unit==="%"?D(n,t,r):n}function k(a,e,t){const r=y(a,e,t);return r.x=(e-r.width)/2,r.y=(t-r.height)/2,a.unit==="%"?D(r,e,t):r}function D(a,e,t){return a.unit==="%"?{...H,...a,unit:"%"}:{unit:"%",x:a.x?a.x/e*100:0,y:a.y?a.y/t*100:0,width:a.width?a.width/e*100:0,height:a.height?a.height/t*100:0}}function y(a,e,t){return a.unit?a.unit==="px"?{...H,...a,unit:"px"}:{unit:"px",x:a.x?a.x*e/100:0,y:a.y?a.y*t/100:0,width:a.width?a.width*e/100:0,height:a.height?a.height*t/100:0}:{...H,...a,unit:"px"}}function X(a,e,t,r,n,i=0,s=0,l=r,h=n){const o={...a};let c=Math.min(i,r),w=Math.min(s,n),p=Math.min(l,r),d=Math.min(h,n);e&&(e>1?(c=s?s*e:c,w=c/e,p=l*e):(w=i?i/e:w,c=w*e,d=h/e)),o.y<0&&(o.height=Math.max(o.height+o.y,w),o.y=0),o.x<0&&(o.width=Math.max(o.width+o.x,c),o.x=0);const u=r-(o.x+o.width);u<0&&(o.x=Math.min(o.x,r-c),o.width+=u);const x=n-(o.y+o.height);if(x<0&&(o.y=Math.min(o.y,n-w),o.height+=x),o.width<c&&((t==="sw"||t=="nw")&&(o.x-=c-o.width),o.width=c),o.height<w&&((t==="nw"||t=="ne")&&(o.y-=w-o.height),o.height=w),o.width>p&&((t==="sw"||t=="nw")&&(o.x-=p-o.width),o.width=p),o.height>d&&((t==="nw"||t=="ne")&&(o.y-=d-o.height),o.height=d),e){const f=o.width/o.height;if(f<e){const C=Math.max(o.width/e,w);(t==="nw"||t=="ne")&&(o.y-=C-o.height),o.height=C}else if(f>e){const C=Math.max(o.height*e,c);(t==="sw"||t=="nw")&&(o.x-=C-o.width),o.width=C}}return o}function P(a,e,t,r){const n={...a};return e==="ArrowLeft"?r==="nw"?(n.x-=t,n.y-=t,n.width+=t,n.height+=t):r==="w"?(n.x-=t,n.width+=t):r==="sw"?(n.x-=t,n.width+=t,n.height+=t):r==="ne"?(n.y+=t,n.width-=t,n.height-=t):r==="e"?n.width-=t:r==="se"&&(n.width-=t,n.height-=t):e==="ArrowRight"&&(r==="nw"?(n.x+=t,n.y+=t,n.width-=t,n.height-=t):r==="w"?(n.x+=t,n.width-=t):r==="sw"?(n.x+=t,n.width-=t,n.height-=t):r==="ne"?(n.y-=t,n.width+=t,n.height+=t):r==="e"?n.width+=t:r==="se"&&(n.width+=t,n.height+=t)),e==="ArrowUp"?r==="nw"?(n.x-=t,n.y-=t,n.width+=t,n.height+=t):r==="n"?(n.y-=t,n.height+=t):r==="ne"?(n.y-=t,n.width+=t,n.height+=t):r==="sw"?(n.x+=t,n.width-=t,n.height-=t):r==="s"?n.height-=t:r==="se"&&(n.width-=t,n.height-=t):e==="ArrowDown"&&(r==="nw"?(n.x+=t,n.y+=t,n.width-=t,n.height-=t):r==="n"?(n.y+=t,n.height-=t):r==="ne"?(n.y+=t,n.width-=t,n.height-=t):r==="sw"?(n.x-=t,n.width+=t,n.height+=t):r==="s"?n.height+=t:r==="se"&&(n.width+=t,n.height+=t)),n}const R={capture:!0,passive:!1},v=class m extends M.PureComponent{constructor(){super(...arguments),this.docMoveBound=!1,this.mouseDownOnCrop=!1,this.dragStarted=!1,this.evData={startClientX:0,startClientY:0,startCropX:0,startCropY:0,clientX:0,clientY:0,isResize:!0},this.componentRef=M.createRef(),this.mediaRef=M.createRef(),this.initChangeCalled=!1,this.state={cropIsActive:!1,newCropIsBeingDrawn:!1},this.onCropPointerDown=e=>{const{crop:t,disabled:r}=this.props,n=this.getBox();if(!t)return;const i=y(t,n.width,n.height);if(r)return;e.cancelable&&e.preventDefault(),this.bindDocMove(),this.componentRef.current.focus({preventScroll:!0});const s=e.target.dataset.ord,l=!!s;let h=e.clientX,o=e.clientY,c=i.x,w=i.y;if(s){const p=e.clientX-n.x,d=e.clientY-n.y;let u=0,x=0;s==="ne"||s=="e"?(u=p-(i.x+i.width),x=d-i.y,c=i.x,w=i.y+i.height):s==="se"||s==="s"?(u=p-(i.x+i.width),x=d-(i.y+i.height),c=i.x,w=i.y):s==="sw"||s=="w"?(u=p-i.x,x=d-(i.y+i.height),c=i.x+i.width,w=i.y):(s==="nw"||s=="n")&&(u=p-i.x,x=d-i.y,c=i.x+i.width,w=i.y+i.height),h=c+n.x+u,o=w+n.y+x}this.evData={startClientX:h,startClientY:o,startCropX:c,startCropY:w,clientX:e.clientX,clientY:e.clientY,isResize:l,ord:s},this.mouseDownOnCrop=!0,this.setState({cropIsActive:!0})},this.onComponentPointerDown=e=>{const{crop:t,disabled:r,locked:n,keepSelection:i,onChange:s}=this.props,l=this.getBox();if(r||n||i&&t)return;e.cancelable&&e.preventDefault(),this.bindDocMove(),this.componentRef.current.focus({preventScroll:!0});const h=e.clientX-l.x,o=e.clientY-l.y,c={unit:"px",x:h,y:o,width:0,height:0};this.evData={startClientX:e.clientX,startClientY:e.clientY,startCropX:h,startCropY:o,clientX:e.clientX,clientY:e.clientY,isResize:!0},this.mouseDownOnCrop=!0,s(y(c,l.width,l.height),D(c,l.width,l.height)),this.setState({cropIsActive:!0,newCropIsBeingDrawn:!0})},this.onDocPointerMove=e=>{const{crop:t,disabled:r,onChange:n,onDragStart:i}=this.props,s=this.getBox();if(r||!t||!this.mouseDownOnCrop)return;e.cancelable&&e.preventDefault(),this.dragStarted||(this.dragStarted=!0,i&&i(e));const{evData:l}=this;l.clientX=e.clientX,l.clientY=e.clientY;let h;l.isResize?h=this.resizeCrop():h=this.dragCrop(),Y(t,h)||n(y(h,s.width,s.height),D(h,s.width,s.height))},this.onComponentKeyDown=e=>{const{crop:t,disabled:r,onChange:n,onComplete:i}=this.props;if(r)return;const s=e.key;let l=!1;if(!t)return;const h=this.getBox(),o=this.makePixelCrop(h),c=(navigator.platform.match("Mac")?e.metaKey:e.ctrlKey)?m.nudgeStepLarge:e.shiftKey?m.nudgeStepMedium:m.nudgeStep;if(s==="ArrowLeft"?(o.x-=c,l=!0):s==="ArrowRight"?(o.x+=c,l=!0):s==="ArrowUp"?(o.y-=c,l=!0):s==="ArrowDown"&&(o.y+=c,l=!0),l){e.cancelable&&e.preventDefault(),o.x=b(o.x,0,h.width-o.width),o.y=b(o.y,0,h.height-o.height);const w=y(o,h.width,h.height),p=D(o,h.width,h.height);n(w,p),i&&i(w,p)}},this.onHandlerKeyDown=(e,t)=>{const{aspect:r=0,crop:n,disabled:i,minWidth:s=0,minHeight:l=0,maxWidth:h,maxHeight:o,onChange:c,onComplete:w}=this.props,p=this.getBox();if(i||!n)return;if(e.key==="ArrowUp"||e.key==="ArrowDown"||e.key==="ArrowLeft"||e.key==="ArrowRight")e.stopPropagation(),e.preventDefault();else return;const d=(navigator.platform.match("Mac")?e.metaKey:e.ctrlKey)?m.nudgeStepLarge:e.shiftKey?m.nudgeStepMedium:m.nudgeStep,u=y(n,p.width,p.height),x=P(u,e.key,d,t),f=X(x,r,t,p.width,p.height,s,l,h,o);if(!Y(n,f)){const C=D(f,p.width,p.height);c(f,C),w&&w(f,C)}},this.onDocPointerDone=e=>{const{crop:t,disabled:r,onComplete:n,onDragEnd:i}=this.props,s=this.getBox();this.unbindDocMove(),!(r||!t)&&this.mouseDownOnCrop&&(this.mouseDownOnCrop=!1,this.dragStarted=!1,i&&i(e),n&&n(y(t,s.width,s.height),D(t,s.width,s.height)),this.setState({cropIsActive:!1,newCropIsBeingDrawn:!1}))},this.onDragFocus=e=>{var t;(t=this.componentRef.current)==null||t.scrollTo(0,0)}}get document(){return document}getBox(){const e=this.mediaRef.current;if(!e)return{x:0,y:0,width:0,height:0};const{x:t,y:r,width:n,height:i}=e.getBoundingClientRect();return{x:t,y:r,width:n,height:i}}componentDidUpdate(e){const{crop:t,onComplete:r}=this.props;if(r&&!e.crop&&t){const{width:n,height:i}=this.getBox();n&&i&&r(y(t,n,i),D(t,n,i))}}componentWillUnmount(){this.resizeObserver&&this.resizeObserver.disconnect()}bindDocMove(){this.docMoveBound||(this.document.addEventListener("pointermove",this.onDocPointerMove,R),this.document.addEventListener("pointerup",this.onDocPointerDone,R),this.document.addEventListener("pointercancel",this.onDocPointerDone,R),this.docMoveBound=!0)}unbindDocMove(){this.docMoveBound&&(this.document.removeEventListener("pointermove",this.onDocPointerMove,R),this.document.removeEventListener("pointerup",this.onDocPointerDone,R),this.document.removeEventListener("pointercancel",this.onDocPointerDone,R),this.docMoveBound=!1)}getCropStyle(){const{crop:e}=this.props;if(e)return{top:`${e.y}${e.unit}`,left:`${e.x}${e.unit}`,width:`${e.width}${e.unit}`,height:`${e.height}${e.unit}`}}dragCrop(){const{evData:e}=this,t=this.getBox(),r=this.makePixelCrop(t),n=e.clientX-e.startClientX,i=e.clientY-e.startClientY;return r.x=b(e.startCropX+n,0,t.width-r.width),r.y=b(e.startCropY+i,0,t.height-r.height),r}getPointRegion(e,t,r,n){const{evData:i}=this,s=i.clientX-e.x,l=i.clientY-e.y;let h;n&&t?h=t==="nw"||t==="n"||t==="ne":h=l<i.startCropY;let o;return r&&t?o=t==="nw"||t==="w"||t==="sw":o=s<i.startCropX,o?h?"nw":"sw":h?"ne":"se"}resolveMinDimensions(e,t,r=0,n=0){let i=Math.min(r,e.width),s=Math.min(n,e.height);return!t||!i&&!s?[i,s]:t>1?i?[i,i/t]:[s*t,s]:s?[s*t,s]:[i,i/t]}resizeCrop(){const{evData:e}=this,{aspect:t=0,maxWidth:r,maxHeight:n}=this.props,i=this.getBox(),[s,l]=this.resolveMinDimensions(i,t,this.props.minWidth,this.props.minHeight);let h=this.makePixelCrop(i),o=this.getPointRegion(i,e.ord,s,l);const c=e.ord||o;let w=e.clientX-e.startClientX,p=e.clientY-e.startClientY;(s&&c==="nw"||c==="w"||c==="sw")&&(w=Math.min(w,-s)),(l&&c==="nw"||c==="n"||c==="ne")&&(p=Math.min(p,-l));const d={unit:"px",x:0,y:0,width:0,height:0};o==="ne"?(d.x=e.startCropX,d.width=w,t?(d.height=d.width/t,d.y=e.startCropY-d.height):(d.height=Math.abs(p),d.y=e.startCropY-d.height)):o==="se"?(d.x=e.startCropX,d.y=e.startCropY,d.width=w,t?d.height=d.width/t:d.height=p):o==="sw"?(d.x=e.startCropX+w,d.y=e.startCropY,d.width=Math.abs(w),t?d.height=d.width/t:d.height=p):o==="nw"&&(d.x=e.startCropX+w,d.width=Math.abs(w),t?(d.height=d.width/t,d.y=e.startCropY-d.height):(d.height=Math.abs(p),d.y=e.startCropY+p));const u=X(d,t,o,i.width,i.height,s,l,r,n);return t||m.xyOrds.indexOf(c)>-1?h=u:m.xOrds.indexOf(c)>-1?(h.x=u.x,h.width=u.width):m.yOrds.indexOf(c)>-1&&(h.y=u.y,h.height=u.height),h.x=b(h.x,0,i.width-h.width),h.y=b(h.y,0,i.height-h.height),h}createCropSelection(){const{ariaLabels:e=m.defaultProps.ariaLabels,disabled:t,locked:r,renderSelectionAddon:n,ruleOfThirds:i,crop:s}=this.props,l=this.getCropStyle();if(s)return g.createElement("div",{style:l,className:"ReactCrop__crop-selection",onPointerDown:this.onCropPointerDown,"aria-label":e.cropArea,tabIndex:0,onKeyDown:this.onComponentKeyDown,role:"group"},!t&&!r&&g.createElement("div",{className:"ReactCrop__drag-elements",onFocus:this.onDragFocus},g.createElement("div",{className:"ReactCrop__drag-bar ord-n","data-ord":"n"}),g.createElement("div",{className:"ReactCrop__drag-bar ord-e","data-ord":"e"}),g.createElement("div",{className:"ReactCrop__drag-bar ord-s","data-ord":"s"}),g.createElement("div",{className:"ReactCrop__drag-bar ord-w","data-ord":"w"}),g.createElement("div",{className:"ReactCrop__drag-handle ord-nw","data-ord":"nw",tabIndex:0,"aria-label":e.nwDragHandle,onKeyDown:h=>this.onHandlerKeyDown(h,"nw"),role:"button"}),g.createElement("div",{className:"ReactCrop__drag-handle ord-n","data-ord":"n",tabIndex:0,"aria-label":e.nDragHandle,onKeyDown:h=>this.onHandlerKeyDown(h,"n"),role:"button"}),g.createElement("div",{className:"ReactCrop__drag-handle ord-ne","data-ord":"ne",tabIndex:0,"aria-label":e.neDragHandle,onKeyDown:h=>this.onHandlerKeyDown(h,"ne"),role:"button"}),g.createElement("div",{className:"ReactCrop__drag-handle ord-e","data-ord":"e",tabIndex:0,"aria-label":e.eDragHandle,onKeyDown:h=>this.onHandlerKeyDown(h,"e"),role:"button"}),g.createElement("div",{className:"ReactCrop__drag-handle ord-se","data-ord":"se",tabIndex:0,"aria-label":e.seDragHandle,onKeyDown:h=>this.onHandlerKeyDown(h,"se"),role:"button"}),g.createElement("div",{className:"ReactCrop__drag-handle ord-s","data-ord":"s",tabIndex:0,"aria-label":e.sDragHandle,onKeyDown:h=>this.onHandlerKeyDown(h,"s"),role:"button"}),g.createElement("div",{className:"ReactCrop__drag-handle ord-sw","data-ord":"sw",tabIndex:0,"aria-label":e.swDragHandle,onKeyDown:h=>this.onHandlerKeyDown(h,"sw"),role:"button"}),g.createElement("div",{className:"ReactCrop__drag-handle ord-w","data-ord":"w",tabIndex:0,"aria-label":e.wDragHandle,onKeyDown:h=>this.onHandlerKeyDown(h,"w"),role:"button"})),n&&g.createElement("div",{className:"ReactCrop__selection-addon",onMouseDown:h=>h.stopPropagation()},n(this.state)),i&&g.createElement(g.Fragment,null,g.createElement("div",{className:"ReactCrop__rule-of-thirds-hz"}),g.createElement("div",{className:"ReactCrop__rule-of-thirds-vt"})))}makePixelCrop(e){const t={...H,...this.props.crop||{}};return y(t,e.width,e.height)}render(){const{aspect:e,children:t,circularCrop:r,className:n,crop:i,disabled:s,locked:l,style:h,ruleOfThirds:o}=this.props,{cropIsActive:c,newCropIsBeingDrawn:w}=this.state,p=i?this.createCropSelection():null,d=E("ReactCrop",n,c&&"ReactCrop--active",s&&"ReactCrop--disabled",l&&"ReactCrop--locked",w&&"ReactCrop--new-crop",i&&e&&"ReactCrop--fixed-aspect",i&&r&&"ReactCrop--circular-crop",i&&o&&"ReactCrop--rule-of-thirds",!this.dragStarted&&i&&!i.width&&!i.height&&"ReactCrop--invisible-crop",r&&"ReactCrop--no-animate");return g.createElement("div",{ref:this.componentRef,className:d,style:h},g.createElement("div",{ref:this.mediaRef,className:"ReactCrop__child-wrapper",onPointerDown:this.onComponentPointerDown},t),p)}};v.xOrds=["e","w"];v.yOrds=["n","s"];v.xyOrds=["nw","ne","se","sw"];v.nudgeStep=1;v.nudgeStepMedium=10;v.nudgeStepLarge=100;v.defaultProps={ariaLabels:{cropArea:"Use the arrow keys to move the crop selection area",nwDragHandle:"Use the arrow keys to move the north west drag handle to change the crop selection area",nDragHandle:"Use the up and down arrow keys to move the north drag handle to change the crop selection area",neDragHandle:"Use the arrow keys to move the north east drag handle to change the crop selection area",eDragHandle:"Use the up and down arrow keys to move the east drag handle to change the crop selection area",seDragHandle:"Use the arrow keys to move the south east drag handle to change the crop selection area",sDragHandle:"Use the up and down arrow keys to move the south drag handle to change the crop selection area",swDragHandle:"Use the arrow keys to move the south west drag handle to change the crop selection area",wDragHandle:"Use the up and down arrow keys to move the west drag handle to change the crop selection area"}};let I=v;function N(a,e,t){M.useEffect(()=>{const r=setTimeout(()=>{a.apply(void 0,t)},e);return()=>{clearTimeout(r)}},t)}const S=Math.PI/180;async function A(a,e,t,r=1,n=0){const i=e.getContext("2d");if(!i)throw new Error("No 2d context");const s=a.naturalWidth/a.width,l=a.naturalHeight/a.height,h=window.devicePixelRatio;e.width=Math.floor(t.width*s*h),e.height=Math.floor(t.height*l*h),i.scale(h,h),i.imageSmoothingQuality="high";const o=t.x*s,c=t.y*l,w=n*S,p=a.naturalWidth/2,d=a.naturalHeight/2;i.save(),i.translate(-o,-c),i.translate(p,d),i.rotate(w),i.scale(r,r),i.translate(-p,-d),i.drawImage(a,0,0,a.naturalWidth,a.naturalHeight,0,0,a.naturalWidth,a.naturalHeight),i.restore()}export{_ as H,I,k as N,A as c,N as u};
