import{r,W as se,j as e,n as K}from"./app-1abff991.js";import{u as re,I as te,c as ne,N as ie,H as le}from"./canvasPreview-f20b28ba.js";import{U as oe}from"./UMKMAdminLayout-45b35b84.js";import{B as P}from"./Button-41989ba7.js";import{M as ce}from"./Modal-d1fc485f.js";import{S as F}from"./SelectInput-6e6f8ef3.js";import{T as v}from"./TextInput-41877d7c.js";import{T as de}from"./TextArea-ce19fe4d.js";import{L as me}from"./Loading-f3e3b1f4.js";import{I as o}from"./InputError-79c2b369.js";import{C as M}from"./Checkbox-b6000747.js";import{F as he}from"./index.esm-d47dd636.js";import{B as b}from"./index.esm-50f203ce.js";import{T as L}from"./index.esm-bb6d21a8.js";import{DataTable as ge}from"./DataTable-599fa949.js";import{l as ue}from"./index-889a8686.js";import"./Sidebar-a7638bcc.js";import"./truncateText-0efa5ecd.js";import"./index.esm-7009594e.js";import"./iconBase-d7a64011.js";import"./index.esm-b9ae67de.js";import"./transition-dbf23572.js";import"./table-081ac3df.js";import"./dropdown-menu-86da1dd9.js";import"./Columns-5a1d3f54.js";import"./formatRupiah-c70df3af.js";import"./RowActions-979ef695.js";import"./index.esm-ee10d79b.js";import"./checkbox-15aaa6e3.js";function Ye({auth:U,listProductsUMKM:B}){const[G,y]=r.useState(!1),{data:d,setData:i,post:W,processing:$,errors:l,reset:z}=se({kategori:"",thumbnail:null,images:null,nama:"",deskripsi:"",harga_start:"",harga_end:"",harga_fix:"",detail:{}}),[w,_]=r.useState("Pilih Kategori"),[m,N]=r.useState(""),[g,H]=r.useState(null),[xe,I]=r.useState(""),[u,A]=r.useState([]),[O,X]=r.useState([]),x=r.useRef(null),p=r.useRef(null);r.useRef(null),r.useRef("");const[Y,D]=r.useState(),[t,q]=r.useState(),[C,pe]=r.useState(1),[S,fe]=r.useState(0),[k,je]=r.useState(null),[f,E]=r.useState(null);function J(a){const s=a.target.files[0];if(i("thumbnail",s),E(null),s){const n=new FileReader;n.onload=j=>{H(j.target.result)},n.readAsDataURL(s),I(s.name)}}const Q=a=>{const s=a.target.files;if(i("images",s),s){const n=[];[...s].forEach(c=>{const h=new FileReader;h.onload=T=>{n.push(T.target.result),X(R=>[...R,c.name])},h.readAsDataURL(c)}),A(n)}};function V(a){a.preventDefault(),W(route("productUMKM.store"),{onSuccess:()=>{K.success("Berhasil menyimpan data produk."),y(!1),z(),_("Pilih Kategori"),H(null),I(""),N(""),A("")},onError:()=>{console.log(l),K.error("Gagal menyimpan data produk")}})}function Z(a,s,n){return ie(le({unit:"%",width:90},n,a,s),a,s)}function ee(a){if(k){const{width:s,height:n}=a.currentTarget;D(Z(s,n,k))}}async function ae(){const a=p.current,s=x.current;if(!a||!s||!t)throw new Error("Crop canvas does not exist");const n=a.naturalWidth/a.width,j=a.naturalHeight/a.height,c=new OffscreenCanvas(t.width*n,t.height*j),h=c.getContext("2d");if(!h)throw new Error("No 2d context");h.drawImage(s,0,0,s.width,s.height,0,0,c.width,c.height);const T=await c.convertToBlob({type:"image/png"}),R=new File([T],"image.png",{type:"image/png"});E(R)}return re(async()=>{t!=null&&t.width&&(t!=null&&t.height)&&p.current&&x.current&&ne(p.current,x.current,t,C,S)},100,[t,C,S]),r.useEffect(()=>{f!==null&&i("thumbnail",f)},[f]),e.jsxs(oe,{auth:U,cta:e.jsx(P,{variant:"primary",text:"Tambah Produk",icon:e.jsx(b,{}),onClick:()=>y(!0)}),x:!0,children:[e.jsx("div",{className:"max-w-[75vw] overflow-auto",children:e.jsx(ge,{data:B})}),e.jsxs(ce,{maxWidth:"lg",show:G,onClose:()=>y(!1),children:[e.jsx("h1",{className:"font-semibold text-xl mb-10 flex items-center gap-x-3",children:e.jsxs(e.Fragment,{children:[e.jsx(b,{size:25}),e.jsx("span",{children:"Tambah Produk"})]})}),e.jsxs("form",{onSubmit:V,className:"flex flex-col gap-y-5",children:[e.jsxs("div",{children:[e.jsxs(F,{children:[e.jsx(F.Trigger,{label:"Kategori Produk",selected:w!=="Pilih Kategori",children:e.jsx("div",{className:w==="Pilih Kategori"?"text-gray-500":"",children:w})}),e.jsx(F.Content,{positionClass:"top-12",children:e.jsx("div",{className:"max-h-[12rem] overflow-auto",children:e.jsx("ul",{children:ue.map((a,s)=>e.jsx("li",{className:"py-2 rounded-md cursor-pointer hover:bg-gray-100 hover:px-4 duration-300",onClick:()=>{_(a),i("kategori",a)},children:a},s))})})})]}),e.jsx(o,{message:l.kategori})]}),e.jsxs("div",{children:[e.jsxs("label",{children:[e.jsx("div",{className:"rounded-md border border-dashed border-gray-300 h-[4rem] w-full flex justify-center items-center cursor-pointer hover:bg-gray-50 duration-300",children:e.jsxs("div",{className:"flex items-center gap-x-3 text-gray-500",children:[g?e.jsx(L,{}):e.jsx(b,{}),e.jsxs("span",{children:[g?"Ganti":"Upload"," Gambar (Thumbnail)"]})]})}),e.jsx("input",{type:"file",hidden:!0,onChange:J})]}),e.jsx(o,{message:l.thumbnail}),g&&e.jsxs("div",{className:"p-3 border rounded-md mt-3",children:[f===null&&e.jsxs(e.Fragment,{children:[e.jsx(te,{crop:Y,onChange:(a,s)=>D(s),onComplete:a=>q(a),aspect:k,children:e.jsx("img",{ref:p,alt:"Crop me",src:g,style:{transform:`scale(${C}) rotate(${S}deg)`},onLoad:ee})}),e.jsx("div",{className:"mt-3 flex justify-end",children:e.jsx(P,{type:"button",text:"Crop",onClick:ae})})]}),e.jsx("canvas",{ref:x,style:{objectFit:"contain",width:t==null?void 0:t.width,height:t==null?void 0:t.height}})]})]}),e.jsxs("div",{children:[e.jsxs("label",{children:[e.jsx("div",{className:"rounded-md border border-dashed border-gray-300 h-[4rem] w-full flex justify-center items-center cursor-pointer hover:bg-gray-50 duration-300",children:e.jsxs("div",{className:"flex items-center gap-x-3 text-gray-500",children:[u.length>0?e.jsx(L,{}):e.jsx(b,{}),e.jsxs("span",{children:[u.length>0?"Ganti":"Upload"," ","Gambar Lainnya"]})]})}),e.jsx("input",{type:"file",hidden:!0,onChange:Q,multiple:!0})]}),e.jsx(o,{message:l.images}),u.length>0&&u.map((a,s)=>e.jsx("div",{className:"p-3 border rounded-md mt-3",children:e.jsxs("div",{className:"h-[5rem] flex gap-x-5",children:[e.jsx("div",{children:e.jsx("img",{src:a,alt:"Preview",className:"h-full"})}),e.jsx("p",{className:"text-gray-500",children:O[s]})]})},s))]}),e.jsxs("div",{children:[e.jsx(v,{label:"Nama Produk",placeholder:"Nama Produk",value:d.nama,onChange:a=>i("nama",a.target.value)}),e.jsx(o,{message:l.nama})]}),e.jsxs("div",{children:[e.jsx(de,{label:"Deskripsi",placeholder:"Deskripsi",value:d.deskripsi,onChange:a=>i("deskripsi",a.target.value)}),e.jsx(o,{message:l.deskripsi})]}),e.jsxs("div",{className:"flex gap-x-5",children:[e.jsxs("div",{className:"flex items-center gap-x-3",children:[e.jsx(M,{id:"hargaRange",checked:m==="range",onChange:()=>N("range")}),e.jsx("label",{htmlFor:"hargaRange",children:"Harga Range"})]}),e.jsxs("div",{className:"flex items-center gap-x-3",children:[e.jsx(M,{id:"hargaFix",checked:m==="fix",onChange:()=>N("fix")}),e.jsx("label",{htmlFor:"hargaFix",children:"Harga Tetap"})]})]}),e.jsxs("div",{children:[m!==""&&e.jsx("p",{children:"Rp. "}),m==="range"&&e.jsxs("section",{className:"grid grid-cols-2 gap-5",children:[e.jsx(v,{type:"number",label:"Dari Harga",placeholder:"Dari Harga",value:d.harga_start,onChange:a=>i("harga_start",a.target.value)}),e.jsx(o,{message:l.harga_start}),e.jsx(v,{type:"number",label:"Hingga Harga",placeholder:"Hingga Harga",value:d.harga_end,onChange:a=>i("harga_end",a.target.value)}),e.jsx(o,{message:l.harga_end})]}),m==="fix"&&e.jsxs(e.Fragment,{children:[e.jsx(v,{type:"number",label:"Harga Produk",placeholder:"Harga Produk",value:d.harga_fix,onChange:a=>i("harga_fix",a.target.value)}),e.jsx(o,{message:l.harga_fix})]})]}),$?e.jsx(me,{}):e.jsx(P,{variant:"primary",text:"Simpan",icon:e.jsx(he,{})})]})]})]})}export{Ye as default};
