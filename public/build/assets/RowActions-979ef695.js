import{r as t,W as oe,j as e,n as w}from"./app-1abff991.js";import{u as de,I as ce,c as he,N as me,H as ge}from"./canvasPreview-f20b28ba.js";import{D as ue,a as xe,B as pe,M as fe,b as je,d as be,e as ve,f as L}from"./dropdown-menu-86da1dd9.js";import{B as y}from"./Button-41989ba7.js";import{M as Ne}from"./Modal-d1fc485f.js";import{S as I}from"./SelectInput-6e6f8ef3.js";import{T as k}from"./TextInput-41877d7c.js";import{L as U}from"./Loading-f3e3b1f4.js";import{C as G}from"./Checkbox-b6000747.js";import{T as we}from"./TextArea-ce19fe4d.js";import{B as O}from"./index.esm-50f203ce.js";import{T as $}from"./index.esm-bb6d21a8.js";import{a as ye,F as ke,b as Ce}from"./index.esm-d47dd636.js";import{I as d}from"./InputError-79c2b369.js";import{I as Se}from"./index.esm-ee10d79b.js";import{B as _e}from"./index.esm-7009594e.js";import{l as De}from"./index-889a8686.js";import"./transition-dbf23572.js";import"./iconBase-d7a64011.js";function Ze({row:z}){const r=z.original,[J,h]=t.useState(!1),{data:m,setData:l,post:R,processing:E,errors:o,reset:Te}=oe({kategori:"",thumbnail:null,nama:"",deskripsi:"",harga_start:"",harga_end:"",harga_fix:"",detail:{}}),[C,S]=t.useState("Pilih Kategori"),[g,u]=t.useState(""),[p,H]=t.useState(null),[Fe,W]=t.useState(""),[P,A]=t.useState(""),[f,X]=t.useState([]),[Y,q]=t.useState([]),j=t.useRef(null),b=t.useRef(null);t.useRef(null),t.useRef("");const[Q,B]=t.useState(),[n,V]=t.useState(),[_,Me]=t.useState(1),[D,Ie]=t.useState(0),[T,Re]=t.useState(null),[v,K]=t.useState(null);function Z(){A("update"),h(!0),S(r.kategori),l({kategori:r.kategori,nama:r.nama,deskripsi:r.deskripsi,harga_start:r.harga_start,harga_end:r.harga_end,harga_fix:r.harga_fix}),r.harga_fix!==null&&u("fix"),(r.harga_start!==null||r.harga_end!==null)&&u("range")}function ee(a){const s=a.target.files[0];if(l("thumbnail",s),K(null),s){const i=new FileReader;i.onload=N=>{H(N.target.result)},i.readAsDataURL(s),W(s.name)}}const ae=a=>{const s=a.target.files;if(l("images",s),s){const i=[];[...s].forEach(c=>{const x=new FileReader;x.onload=F=>{i.push(F.target.result),q(M=>[...M,c.name])},x.readAsDataURL(c)}),X(i)}};function se(a){a.preventDefault(),R(route("productUMKM.update",r.id),{onSuccess:()=>{w.success("Berhasil memperbarui data produk."),h(!1),S("Pilih Kategori"),H(null),setImageName(""),u("")},onError:s=>{w.error("Gagal memperbarui data produk."),console.log(s),console.log(o)}})}function re(){A("delete"),h(!0)}function te(){R(route("productUMKM.delete",r.id),{onSuccess:()=>{w.success("Berhasil menghapus data produk."),h(!1)},onError:a=>{w.error("Gagal menghapus data produk."),console.log(a),console.log(o)}})}function ne(a,s,i){return me(ge({unit:"%",width:90},i,a,s),a,s)}function ie(a){if(T){const{width:s,height:i}=a.currentTarget;B(ne(s,i,T))}}async function le(){const a=b.current,s=j.current;if(!a||!s||!n)throw new Error("Crop canvas does not exist");const i=a.naturalWidth/a.width,N=a.naturalHeight/a.height,c=new OffscreenCanvas(n.width*i,n.height*N),x=c.getContext("2d");if(!x)throw new Error("No 2d context");x.drawImage(s,0,0,s.width,s.height,0,0,c.width,c.height);const F=await c.convertToBlob({type:"image/png"}),M=new File([F],"image.png",{type:"image/png"});K(M)}return de(async()=>{n!=null&&n.width&&(n!=null&&n.height)&&b.current&&j.current&&he(b.current,j.current,n,_,D)},100,[n,_,D]),t.useEffect(()=>{v!==null&&l("thumbnail",v)},[v]),e.jsxs(e.Fragment,{children:[e.jsxs(ue,{children:[e.jsx(xe,{asChild:!0,children:e.jsxs(pe,{variant:"ghost",className:"h-8 w-8 p-0",children:[e.jsx("span",{className:"sr-only",children:"Open menu"}),e.jsx(fe,{className:"h-4 w-4"})]})}),e.jsxs(je,{align:"end",children:[e.jsx(be,{children:"Actions"}),e.jsx(ve,{}),e.jsx(L,{onClick:Z,children:"Edit Data"}),e.jsx(L,{onClick:re,children:"Delete Data"})]})]}),e.jsxs(Ne,{maxWidth:"lg",show:J,onClose:()=>h(!1),children:[P==="update"&&e.jsxs(e.Fragment,{children:[e.jsxs("h1",{className:"font-semibold text-xl mb-10 flex items-center gap-x-3",children:[e.jsx(ye,{size:25}),e.jsx("span",{children:"Edit Produk"})]}),e.jsxs("form",{onSubmit:se,className:"flex flex-col gap-y-5",children:[e.jsxs("div",{children:[e.jsxs(I,{children:[e.jsx(I.Trigger,{label:"Kategori Produk",selected:C!=="Pilih Kategori",children:e.jsx("div",{className:C==="Pilih Kategori"?"text-gray-500":"",children:C})}),e.jsx(I.Content,{positionClass:"top-12",children:e.jsx("div",{className:"max-h-[12rem] overflow-auto",children:e.jsx("ul",{children:De.map((a,s)=>e.jsx("li",{className:"py-2 rounded-md cursor-pointer hover:bg-gray-100 hover:px-4 duration-300",onClick:()=>{S(a),l("kategori",a)},children:a},s))})})})]}),e.jsx(d,{message:o.kategori})]}),e.jsxs("div",{children:[e.jsxs("label",{children:[e.jsx("div",{className:"rounded-md border border-dashed h-[4rem] w-full flex justify-center items-center cursor-pointer hover:bg-gray-50 duration-300",children:e.jsxs("div",{className:"flex items-center gap-x-3 text-gray-500",children:[p||r.thumbnail?e.jsx($,{}):e.jsx(O,{}),e.jsxs("span",{children:[p||r.thumbnail?"Ganti":"Upload"," ","Gambar (Thumnbail)"]})]})}),e.jsx("input",{type:"file",hidden:!0,onChange:ee})]}),e.jsx(d,{message:o.thumbnail}),p?e.jsxs("div",{className:"p-3 border rounded-md mt-3",children:[v===null&&e.jsxs(e.Fragment,{children:[e.jsx(ce,{crop:Q,onChange:(a,s)=>B(s),onComplete:a=>V(a),aspect:T,children:e.jsx("img",{ref:b,alt:"Crop me",src:p,style:{transform:`scale(${_}) rotate(${D}deg)`},onLoad:ie})}),e.jsx("div",{className:"mt-3 flex justify-end",children:e.jsx(y,{type:"button",text:"Crop",onClick:le})})]}),e.jsx("canvas",{ref:j,style:{objectFit:"contain",width:n==null?void 0:n.width,height:n==null?void 0:n.height}})]}):r.thumbnail&&e.jsx("div",{className:"p-3 border rounded-md mt-3",children:e.jsxs("div",{className:"h-[5rem] flex gap-x-5",children:[e.jsx("div",{children:e.jsx("img",{src:`/images/uploads/products/${r.thumbnail}`,alt:"Preview",className:"h-full"})}),e.jsx("p",{className:"text-gray-500",children:r.thumbnail})]})})]}),e.jsxs("div",{children:[e.jsxs("label",{children:[e.jsx("div",{className:"rounded-md border border-dashed border-gray-300 h-[4rem] w-full flex justify-center items-center cursor-pointer hover:bg-gray-50 duration-300",children:e.jsxs("div",{className:"flex items-center gap-x-3 text-gray-500",children:[f.length>0||r.images!==null&&JSON.parse(r.images).length>0?e.jsx($,{}):e.jsx(O,{}),e.jsxs("span",{children:[f.length>0||r.images!==null&&JSON.parse(r.images).length>0?"Ganti":"Upload"," ","Gambar Lainnya (Multiple)"]})]})}),e.jsx("input",{type:"file",hidden:!0,onChange:ae,multiple:!0})]}),e.jsx(d,{message:o.images}),f.length>0?f.map((a,s)=>e.jsx("div",{className:"p-3 border rounded-md mt-3",children:e.jsxs("div",{className:"h-[5rem] flex gap-x-5",children:[e.jsx("div",{children:e.jsx("img",{src:a,alt:"Preview",className:"h-full"})}),e.jsx("p",{className:"text-gray-500",children:Y[s]})]})},s)):r.images!==null&&JSON.parse(r.images).map((a,s)=>e.jsx("div",{className:"p-3 border rounded-md mt-3",children:e.jsxs("div",{className:"h-[5rem] flex gap-x-5",children:[e.jsx("div",{children:e.jsx("img",{src:`/images/uploads/products/${a}`,alt:"Preview",className:"h-full"})}),e.jsx("p",{className:"text-gray-500",children:a})]})},s))]}),e.jsxs("div",{children:[e.jsx(k,{label:"Nama Produk",placeholder:"Nama Produk",value:m.nama,onChange:a=>l("nama",a.target.value)}),e.jsx(d,{message:o.nama})]}),e.jsxs("div",{children:[e.jsx(we,{label:"Deskripsi",placeholder:"Deskripsi",value:m.deskripsi,onChange:a=>l("deskripsi",a.target.value)}),e.jsx(d,{message:o.deskripsi})]}),e.jsxs("div",{className:"flex gap-x-5",children:[e.jsxs("div",{className:"flex items-center gap-x-3",children:[e.jsx(G,{id:"hargaRange",checked:g==="range",onChange:()=>u("range")}),e.jsx("label",{htmlFor:"hargaRange",children:"Harga Range"})]}),e.jsxs("div",{className:"flex items-center gap-x-3",children:[e.jsx(G,{id:"hargaFix",checked:g==="fix",onChange:()=>u("fix")}),e.jsx("label",{htmlFor:"hargaFix",children:"Harga Tetap"})]})]}),e.jsxs("div",{children:[g!==""&&e.jsx("p",{children:"Rp. "}),g==="range"&&e.jsxs("section",{className:"grid grid-cols-2 gap-5",children:[e.jsx(k,{type:"number",label:"Dari Harga",placeholder:"Dari Harga",value:m.harga_start,onChange:a=>l("harga_start",a.target.value)}),e.jsx(d,{message:o.harga_start}),e.jsx(k,{type:"number",label:"Hingga Harga",placeholder:"Hingga Harga",value:m.harga_end,onChange:a=>l("harga_end",a.target.value)}),e.jsx(d,{message:o.harga_end})]}),g==="fix"&&e.jsxs(e.Fragment,{children:[e.jsx(k,{type:"number",label:"Harga Produk",placeholder:"Harga Produk",value:m.harga_fix,onChange:a=>l("harga_fix",a.target.value)}),e.jsx(d,{message:o.harga_fix})]})]}),E?e.jsx(U,{}):e.jsx(y,{variant:"primary",text:"Simpan",icon:e.jsx(ke,{})})]})]}),P==="delete"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mb-10",children:[e.jsxs("h1",{className:"font-semibold text-xl flex items-center gap-x-3",children:[e.jsx(Se,{size:25}),e.jsx("span",{children:"Hapus Akun"})]}),e.jsxs("p",{className:"mt-3",children:["Konfirmasi hapus produk"," ",e.jsx("span",{className:"text-primary",children:r.nama}),"?"]})]}),e.jsx("div",{className:"flex gap-x-3 mt-10",children:E?e.jsx(U,{}):e.jsxs(e.Fragment,{children:[e.jsx(y,{type:"button",text:"Batal",icon:e.jsx(_e,{}),className:"w-full border hover:bg-gray-100",onClick:()=>h(!1)}),e.jsx(y,{type:"button",variant:"primary",text:"Hapus",icon:e.jsx(Ce,{}),className:"w-full",onClick:te})]})})]})]})]})}export{Ze as default};
